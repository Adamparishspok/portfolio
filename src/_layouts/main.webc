<!DOCTYPE html>
<html lang="en" class="scroll-smooth" color-scheme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#08090A" />
    <meta name="author" content="Adam Parish" />
    <link rel="canonical" :href="base.domain + page.url" />

    <!--- Preload Fonts --->
    <link
      rel="preload"
      href="/assets/fonts/Geist-Variable.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/GeistMono-Variable.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />

    <!--- Search + Tab --->
    <title @html="this.seoTitle"></title>
    <meta name="description" :content="this.seoDesc" />

    <!--- OpenGraph --->
    <meta property="og:site_name" :content="base.name" />
    <meta property="og:type" content="website" />
    <meta property="og:title" :content="this.ogTitle" />
    <meta property="og:description" :content="this.ogDesc" />
    <meta property="og:url" :content="base.url + page.url" />
    <meta property="og:image" :content="base.url + this.ogImage" />
    <meta property="og:image:alt" :content="this.ogImageAlt || this.seoTitle" />

    <!--- Twitter --->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" :content="base.twitterHandle" />
    <meta name="twitter:creator" :content="base.twitterHandle" />

    <!--- Prevent Indexing --->
    <meta webc:if="this.noindex" name="robots" content="noindex, nofollow" />

    <script type="application/ld+json" webc:keep>
      {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "Adam Parish",
        "url": "https://atomparish.com",
        "sameAs": [
          "https://twitter.com/atomparish1",
          "https://www.linkedin.com/in/atomizer/",
          "https://dribbble.com/atomparish/",
          "https://github.com/atompariskspok"
        ],
        "jobTitle": "Lead Product Designer",
        "worksFor": {
          "@type": "Organization",
          "name": "Atomic FI"
        }
      }
    </script>

    <script>
      (function (ss, ex) {
        window.ldfdr =
          window.ldfdr ||
          function () {
            (ldfdr._q = ldfdr._q || []).push([].slice.call(arguments));
          };
        (function (d, s) {
          fs = d.getElementsByTagName(s)[0];
          function ce(src) {
            var cs = d.createElement(s);
            cs.src = src;
            cs.async = 1;
            fs.parentNode.insertBefore(cs, fs);
          }
          ce('https://sc.lfeeder.com/lftracker_v1_' + ss + (ex ? '_' + ex : '') + '.js');
        })(document, 'script');
      })('ywVkO4XmPpzaZ6Bj');
    </script>

    <!--- Light/Dark Mode: Set from localStorage or system preference --->
    <script webc:keep>
      (function () {
        const scheme =
          localStorage.getItem('scheme') ||
          (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.setAttribute('color-scheme', scheme);
      })();
    </script>

    <!--- Fonts --->
    <style>
      :root {
        font-family:
          'Geist Sans', 'ui-sans-serif', 'system-ui', 'sans-serif', 'Apple Color Emoji',
          'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
      }
    </style>

    <!--- Styles --->
    <link rel="stylesheet" href="/assets/css/main.css" webc:keep />
    <link webc:if="markdown" rel="stylesheet" href="/assets/css/markdown.css" webc:keep />
    <style @raw="getBundle('css')" webc:keep></style>

    <!--- Icons --->
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="Adam P" />
    <link rel="manifest" href="/site.webmanifest" />

    <!--- PostHog --->
    <script webc:keep src="/assets/js/posthog.min.js"></script>
    <script>
      window.posthog.init('phc_PVCwdgCGgAV76xJR6eA2DxTEwiqejQpFaUyz4oo8ltz', {
        api_host: 'https://us.i.posthog.com',
        person_profiles: 'identified_only',
      });
      // Send initial page load event
      window.posthog.capture('website_loaded', {
        page_url: window.location.href,
        timestamp: new Date().toISOString(),
      });
    </script>
    <!--- Portfolio Analytics --->
    <script webc:keep src="/assets/js/analytics.js"></script>

    <!--- Axe-core for accessibility testing (development only) --->
    <script webc:if="env !== 'production'" webc:keep src="/assets/js/axe-core.js"></script>

    <script async webc:keep src="https://www.googletagmanager.com/gtag/js?id=G-3BCTP3WC02"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'G-3BCTP3WC02');
    </script>
  </head>

  <body
    class="flex min-h-screen flex-col text-zinc-400 antialiased selection:bg-zinc-800 selection:text-zinc-100"
  >
    <!--- Page Transition Overlay --->
    <div
      id="page-transition"
      class="pointer-events-none fixed inset-0 z-40 bg-black opacity-0 transition-opacity duration-500"
    ></div>

    <div
      class="relative mx-auto flex min-h-screen w-full max-w-[1400px] flex-col border-x border-white/10 bg-[#08090A]/40"
    >
      <site-header></site-header>
      <!--- Content --->
      <div id="main-content" class="flex flex-grow flex-col" @html="this.content"></div>
    </div>

    <!-- GSAP Core and Plugins for Page Transitions -->
    <script webc:keep src="/assets/js/gsap.min.js"></script>
    <script webc:keep src="/assets/js/ScrollTrigger.min.js"></script>
    <script webc:keep src="/assets/js/InertiaPlugin.min.js"></script>
    <script @raw="getBundle('js')" webc:keep>
      gsap.registerPlugin(ScrollTrigger, InertiaPlugin);
    </script>
    <!-- UnicornStudio Background Script -->
    <script webc:raw type="text/javascript">
      !(function () {
        if (!window.UnicornStudio) {
          window.UnicornStudio = { isInitialized: !1 };
          var i = document.createElement('script');
          ((i.src =
            'https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.29/dist/unicornStudio.umd.js'),
            (i.onload = function () {
              window.UnicornStudio.isInitialized ||
                (UnicornStudio.init(), (window.UnicornStudio.isInitialized = !0));
            }),
            (document.head || document.body).appendChild(i));
        }
      })();
    </script>

    <!-- Lucide Icons -->

    <!-- Page Transition Scripts -->
    <script webc:raw type="text/javascript">
      // Page Transition System
      class PageTransition {
        constructor() {
          this.transition = document.getElementById('page-transition');
          this.mainContent = document.getElementById('main-content');
          this.isTransitioning = false;

          this.init();
        }

        init() {
          // Handle initial page load
          this.handleInitialLoad();

          // Handle navigation clicks
          this.handleNavigation();

          // Handle browser back/forward
          this.handleBrowserNavigation();
        }

        handleInitialLoad() {
          // Show content immediately on DOMContentLoaded
          // window.addEventListener('load', ...) waits for all images, which is too slow
          this.showContent();
        }

        showContent() {
          if (this.mainContent) {
            // Animate content elements with stagger
            this.animateContentElements();
          }
        }

        animateContentElements() {
          // Try to identify split columns for concurrent animation
          const mainCol = this.mainContent.querySelector('.md\\:col-span-9');
          const sideCol = this.mainContent.querySelector('.md\\:col-span-3');

          // Broad selector for text and card elements
          const selector = 'h1, h2, h3, h4, p, li, span.text-xs, .card, .project-card, .group';

          if (mainCol && sideCol) {
            // Two-column layout: Animate concurrently
            const mainElements = mainCol.querySelectorAll(selector);
            const sideElements = sideCol.querySelectorAll(selector);

            if (mainElements.length > 0) {
              gsap.fromTo(
                mainElements,
                { opacity: 0, y: 15 },
                {
                  opacity: 1,
                  y: 0,
                  duration: 0.5,
                  stagger: 0.03,
                  ease: 'power2.out',
                  delay: 0.1,
                }
              );
            }

            if (sideElements.length > 0) {
              gsap.fromTo(
                sideElements,
                { opacity: 0, y: 15 },
                {
                  opacity: 1,
                  y: 0,
                  duration: 0.5,
                  stagger: 0.03,
                  ease: 'power2.out',
                  delay: 0.15, // Slight offset from main content
                }
              );
            }
          } else {
            // Single column / Fallback
            const elements = this.mainContent.querySelectorAll(selector);
            if (elements.length > 0) {
              gsap.fromTo(
                elements,
                { opacity: 0, y: 15 },
                {
                  opacity: 1,
                  y: 0,
                  duration: 0.5,
                  stagger: 0.03,
                  ease: 'power2.out',
                  delay: 0.1,
                }
              );
            }
          }
        }

        handleNavigation() {
          // Intercept all internal links
          document.addEventListener('click', (e) => {
            const link = e.target.closest('a[href]');
            if (!link) return;

            const href = link.getAttribute('href');

            // Check if it's an internal link (not external, not hash, not mailto/tel)
            if (
              href &&
              !href.startsWith('http') &&
              !href.startsWith('#') &&
              !href.startsWith('mailto:') &&
              !href.startsWith('tel:') &&
              !link.hasAttribute('download')
            ) {
              e.preventDefault();
              this.navigateTo(href);
            }
          });
        }

        handleBrowserNavigation() {
          // Handle browser back/forward buttons
          window.addEventListener('popstate', (e) => {
            if (e.state && e.state.url) {
              this.navigateTo(e.state.url, false);
            }
          });
        }

        async navigateTo(url, addToHistory = true) {
          if (this.isTransitioning) return;
          this.isTransitioning = true;

          try {
            // Show transition overlay
            this.showTransition();

            // Fetch new page content
            const response = await fetch(url);
            const html = await response.text();

            // Parse the HTML to get just the content area
            const parser = new DOMParser();
            const newDoc = parser.parseFromString(html, 'text/html');
            const newContent = newDoc.querySelector('#main-content');

            if (newContent) {
              // Update page title
              const newTitle = newDoc.querySelector('title');
              if (newTitle) {
                document.title = newTitle.textContent;
              }

              // Update URL
              if (addToHistory) {
                history.pushState({ url: url }, '', url);
              }

              // Animate out current content
              await this.animateOutContent();

              // Replace content
              this.mainContent.innerHTML = newContent.innerHTML;

              // Reset scroll position to top
              window.scrollTo(0, 0);

              // Animate in new content
              await this.animateInContent();

              // Update any scripts or dynamic content
              this.updateDynamicContent();
            }
          } catch (error) {
            console.error('Navigation error:', error);
            // Fallback to normal navigation
            window.location.href = url;
          } finally {
            // Hide transition overlay
            this.hideTransition();
            this.isTransitioning = false;
          }
        }

        showTransition() {
          if (this.transition) {
            gsap.to(this.transition, {
              opacity: 1,
              duration: 0.3,
              ease: 'power2.inOut',
            });
          }
        }

        hideTransition() {
          if (this.transition) {
            gsap.to(this.transition, {
              opacity: 0,
              duration: 0.5,
              ease: 'power2.inOut',
            });
          }
        }

        animateOutContent() {
          return new Promise((resolve) => {
            gsap.to(this.mainContent, {
              opacity: 0,
              y: -20,
              duration: 0.4,
              ease: 'power2.in',
              onComplete: resolve,
            });
          });
        }

        animateInContent() {
          return new Promise((resolve) => {
            // Start content animation immediately
            this.animateContentElements();

            // Fade in the container (shell/backgrounds) quickly
            gsap.fromTo(
              this.mainContent,
              {
                opacity: 0,
                y: 0,
              },
              {
                opacity: 1,
                y: 0,
                duration: 0.3,
                ease: 'power2.out',
                onComplete: resolve,
              }
            );
          });
        }

        updateDynamicContent() {
          // Re-initialize any dynamic content like carousels, animations, etc.
          // This can be extended based on what dynamic elements you have

          // Re-initialize UnicornStudio if present
          if (window.UnicornStudio && typeof UnicornStudio.init === 'function') {
            UnicornStudio.init();
          }

          // Dispatch custom event for other scripts to listen to
          window.dispatchEvent(new CustomEvent('pageTransitionComplete'));
        }
      }

      // Initialize when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          new PageTransition();
        });
      } else {
        new PageTransition();
      }
    </script>
  </body>
</html>
